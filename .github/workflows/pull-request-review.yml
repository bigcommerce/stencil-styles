name: Tests

on:
    pull_request:
        branches: [master, main]
    push:
        branches: [master, main]

jobs:
    build:
        strategy:
            matrix:
                node: [22.x]
                os: ['ubuntu-latest', 'windows-2022']

        runs-on: ${{ matrix.os }}

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Use Node.js ${{ matrix.node }}
              uses: actions/setup-node@v4
              with:
                  node-version: ${{ matrix.node }}

            - name: Set up Python
              if: startsWith(matrix.os, 'windows')
              id: py
              uses: actions/setup-python@v5
              with:
                python-version: '3.10'

            - name: Install Visual Studio Build Tools
              if: startsWith(matrix.os, 'windows')
              uses: microsoft/setup-msbuild@v1.1

            - name: Configure npm for Windows
              if: startsWith(matrix.os, 'windows')
              run: |
                npm config set cache-min 86400
              shell: bash
              env:
                GYP_MSVS_VERSION: 2022
                PYTHON: python

            - name: Install Dependencies
              run: npm ci
              shell: bash
              env:
                GYP_MSVS_VERSION: 2022
                PYTHON: python

            - name: Lint the code
              run: npm run lint
              shell: bash

            - name: Run tests
              run: npm run test
              shell: bash
